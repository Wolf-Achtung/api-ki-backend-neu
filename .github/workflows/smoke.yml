name: smoke
on:
  push:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Resolve base URL
        run: |
          if [ -z "${{ vars.BACKEND_BASE }}" ]; then
            echo "BACKEND_BASE is not set (e.g. https://api-ki-backend-neu-production.up.railway.app)"
            exit 2
          fi
          echo "BASE=${{ vars.BACKEND_BASE }}" >> $GITHUB_ENV

      - name: Smoke ping
        run: |
          set -euxo pipefail
          # Health endpoint (present per server logs)
          curl -fsS "${BASE}/api/healthz" -o /dev/null
          # Dedicated smoke endpoint
          curl -fsS "${BASE}/api/smoke" -o /dev/null
          # Optional: report ping (do not fail the workflow if not present)
          curl -fsS "${BASE}/api/report/ping" -o /dev/null || echo "Optional endpoint /api/report/ping not present â€“ continuing."

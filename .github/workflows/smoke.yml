name: smoke

on:
  push:
    branches: [ main ]

jobs:
  smoke:
    runs-on: ubuntu-latest
    env:
      BASE: ${{ vars.BACKEND_BASE }}
    steps:
      - uses: actions/checkout@v4
      - name: Resolve base URL
        run: |
          if [ -z "$BASE" ]; then
            echo "::error title=Missing Actions variable::BACKEND_BASE is not set (e.g. https://your-app.up.railway.app)"
            exit 2
          fi
          echo "Using backend: $BASE"
      - name: Smoke ping
        run: |
          set -e
          url="$BASE/api/healthz?ts=${{ github.run_id }}"
          code=$(curl -s -o /dev/null -w "%{http_code}" "$url")
          echo "GET $url -> $code"
          if [ "$code" != "200" ]; then
            echo "::error title=Smoke ping failed::Expected 200 from $url, got $code"
            exit 2
          fi

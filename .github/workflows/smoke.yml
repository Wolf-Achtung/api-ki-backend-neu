name: smoke
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    env:
      BACKEND_BASE: ${{ vars.BACKEND_BASE }}
    steps:
      - uses: actions/checkout@v4
      - name: Resolve base URL
        id: cfg
        run: |
          if [ -z "${BACKEND_BASE}" ]; then
            echo "BACKEND_BASE not set, fallback to http://localhost:8000" >&2
            echo "base=http://localhost:8000" >> $GITHUB_OUTPUT
          else
            echo "base=${BACKEND_BASE}" >> $GITHUB_OUTPUT
          fi
      - name: Smoke ping
        run: |
          URL="${{ steps.cfg.outputs.base }}/api/report/ping"
          echo "GET $URL"
          curl -fsS "$URL" || (echo "Ping failed"; exit 2)
